!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const i=new WeakMap,r=e=>"function"==typeof e&&i.has(e),s=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(;t!==n;){const n=t.nextSibling;e.removeChild(t),t=n}},a={},l={},c=`{{lit-${String(Math.random()).slice(2)}}}`,d=`\x3c!--${c}--\x3e`,u=new RegExp(`${c}|${d}`),m="$lit$";class h{constructor(e,t){this.parts=[],this.element=t;const n=[],i=[],r=document.createTreeWalker(t.content,133,null,!1);let s=0,o=-1,a=0;const{strings:l,values:{length:d}}=e;for(;a<d;){const e=r.nextNode();if(null!==e){if(o++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:n}=t;let i=0;for(let e=0;e<n;e++)f(t[e].name,m)&&i++;for(;i-- >0;){const t=l[a],n=_.exec(t)[2],i=n.toLowerCase()+m,r=e.getAttribute(i);e.removeAttribute(i);const s=r.split(u);this.parts.push({type:"attribute",index:o,name:n,strings:s}),a+=s.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),r.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(c)>=0){const i=e.parentNode,r=t.split(u),s=r.length-1;for(let t=0;t<s;t++){let n,s=r[t];if(""===s)n=g();else{const e=_.exec(s);null!==e&&f(e[2],m)&&(s=s.slice(0,e.index)+e[1]+e[2].slice(0,-m.length)+e[3]),n=document.createTextNode(s)}i.insertBefore(n,e),this.parts.push({type:"node",index:++o})}""===r[s]?(i.insertBefore(g(),e),n.push(e)):e.data=r[s],a+=s}}else if(8===e.nodeType)if(e.data===c){const t=e.parentNode;null!==e.previousSibling&&o!==s||(o++,t.insertBefore(g(),e)),s=o,this.parts.push({type:"node",index:o}),null===e.nextSibling?e.data="":(n.push(e),o--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(c,t+1));)this.parts.push({type:"node",index:-1}),a++}}else r.currentNode=i.pop()}for(const e of n)e.parentNode.removeChild(e)}}const f=(e,t)=>{const n=e.length-t.length;return n>=0&&e.slice(n)===t},p=e=>-1!==e.index,g=()=>document.createComment(""),_=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class y{constructor(e,t,n){this.__parts=[],this.template=e,this.processor=t,this.options=n}update(e){let t=0;for(const n of this.__parts)void 0!==n&&n.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=s?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],n=this.template.parts,i=document.createTreeWalker(e,133,null,!1);let r,o=0,a=0,l=i.nextNode();for(;o<n.length;)if(r=n[o],p(r)){for(;a<r.index;)a++,"TEMPLATE"===l.nodeName&&(t.push(l),i.currentNode=l.content),null===(l=i.nextNode())&&(i.currentNode=t.pop(),l=i.nextNode());if("node"===r.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(l.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,r.name,r.strings,this.options));o++}else this.__parts.push(void 0),o++;return s&&(document.adoptNode(e),customElements.upgrade(e)),e}}const b=` ${c} `;class v{constructor(e,t,n,i){this.strings=e,this.values=t,this.type=n,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let i=0;i<e;i++){const e=this.strings[i],r=e.lastIndexOf("\x3c!--");n=(r>-1||n)&&-1===e.indexOf("--\x3e",r+1);const s=_.exec(e);t+=null===s?e+(n?b:d):e.substr(0,s.index)+s[1]+s[2]+m+s[3]+c}return t+=this.strings[e]}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}const w=e=>null===e||!("object"==typeof e||"function"==typeof e),O=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class x{constructor(e,t,n){this.dirty=!0,this.element=e,this.name=t,this.strings=n,this.parts=[];for(let e=0;e<n.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new D(this)}_getValue(){const e=this.strings,t=e.length-1;let n="";for(let i=0;i<t;i++){n+=e[i];const t=this.parts[i];if(void 0!==t){const e=t.value;if(w(e)||!O(e))n+="string"==typeof e?e:String(e);else for(const t of e)n+="string"==typeof t?t:String(t)}}return n+=e[t]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class D{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===a||w(e)&&e===this.value||(this.value=e,r(e)||(this.committer.dirty=!0))}commit(){for(;r(this.value);){const e=this.value;this.value=a,e(this)}this.value!==a&&this.committer.commit()}}class C{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(g()),this.endNode=e.appendChild(g())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=g()),e.__insert(this.endNode=g())}insertAfterPart(e){e.__insert(this.startNode=g()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){for(;r(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}const e=this.__pendingValue;e!==a&&(w(e)?e!==this.value&&this.__commitText(e):e instanceof v?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):O(e)?this.__commitIterable(e):e===l?(this.value=l,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof y&&this.value.template===t)this.value.update(e.values);else{const n=new y(t,e.processor,this.options),i=n._clone();n.update(e.values),this.__commitNode(i),this.value=n}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let n,i=0;for(const r of e)void 0===(n=t[i])&&(n=new C(this.options),t.push(n),0===i?n.appendIntoPart(this):n.insertAfterPart(t[i-1])),n.setValue(r),n.commit(),i++;i<t.length&&(t.length=i,this.clear(n&&n.endNode))}clear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startNode;o(this.startNode.parentNode,e.nextSibling,this.endNode)}}class j{constructor(e,t,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=n}setValue(e){this.__pendingValue=e}commit(){for(;r(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}if(this.__pendingValue===a)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=a}}class E extends x{constructor(e,t,n){super(e,t,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new P(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class P extends D{}let S=!1;try{const e={get capture(){return S=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class I{constructor(e,t,n){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=n,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;r(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=a,e(this)}if(this.__pendingValue===a)return;const e=this.__pendingValue,t=this.value,n=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=k(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=a}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const k=e=>e&&(S?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);const N=new class{handleAttributeExpressions(e,t,n,i){const r=t[0];if("."===r){return new E(e,t.slice(1),n).parts}return"@"===r?[new I(e,t.slice(1),i.eventContext)]:"?"===r?[new j(e,t.slice(1),n)]:new x(e,t,n).parts}handleTextExpression(e){return new C(e)}};function T(e){let t=M.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},M.set(e.type,t));let n=t.stringsArray.get(e.strings);if(void 0!==n)return n;const i=e.strings.join(c);return void 0===(n=t.keyString.get(i))&&(n=new h(e,e.getTemplateElement()),t.keyString.set(i,n)),t.stringsArray.set(e.strings,n),n}const M=new Map,L=new WeakMap,$=(e,t,n)=>{let i=L.get(t);void 0===i&&(o(t,t.firstChild),L.set(t,i=new C(Object.assign({templateFactory:T},n))),i.appendInto(t)),i.setValue(e),i.commit()};(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");const A=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new v(e,n,"html",N)},F=e=>{let{system:t}=e;const n=t.getLibrary(),i={modules:{get:e=>n.getModule(e)}};return{deploy:()=>({deploySystem:i})}},W=e=>{let{library:t}=e;const n={id:`libraryInstance-${Date.now()}`,library:t,_interface:{modules:{get:e=>n.library.getModule(e),info:e=>n.library.getModulesInfo(e),define:e=>n.library.addModuleDefinition(e),install:e=>n.library.installModule(e)}},interface:()=>n._interface};return n};class V{constructor(e){let{system:t}=e;this._environment={system:t},this._modulesDEFS={},this._modules={}}getNewInstance(){return W({library:this})}addModuleDefinition(e){let{moduleDefinition:t}=e;if(this._modulesDEFS[t.config.name])throw Error("Module definition already exist");this._modulesDEFS[t.config.name]=t}installModule(e){let{name:t}=e;const n=this._modulesDEFS[t];if(void 0===n)throw Error("Module definition not found");const{system:i}=this._environment,r=F({system:i}),s=n.lifecycle.install(r.deploy());this._modules[t]={name:t,definition:n,module:s},i._environment.mediator.publish("module_installed",{name:t})}getModulesInfo(){return{modules:Object.values(this._modulesDEFS).reduce((e,t,n)=>(e[t.config.name]={name:t.config.name,metadata:t.metadata,installed:void 0!==this._modules[t.config.name]},e),{}),total:Object.keys(this._modulesDEFS).length,installed:Object.keys(this._modules).length}}addModule(e){let{name:t,description:n,module:i,extra:r=null}=e;this._modules[t]={name:t,description:n,module:i,extra:r}}getModule(e){let{name:t}=e;return this._modules[t].module}}var R={getNew_Mediator:()=>{const e=function(){var t=function(t,n){return e.channels[t]||(e.channels[t]=[]),e.channels[t].push({context:this,callback:n}),this},n=function(t){if(!e.channels[t])return!1;for(var n=Array.prototype.slice.call(arguments,1),i=0,r=e.channels[t].length;i<r;i++){var s=e.channels[t][i];s.callback.apply(s.context,n)}return this};return{channels:{},publish:n,subscribe:t,installTo:function(e){e.subscribe=t,e.publish=n}}}();return e}};class q{constructor(){this._worker=null,this._state=null,this.loadFile=this.loadFile.bind(this)}get state(){return this._state}loadFile(e){let{url:t}=e;return new Promise(async(e,n)=>{try{const n=await fetch(t);if(!n.ok)throw new Error("Network response was not ok.");const i=new Blob([await n.text()],{type:"text/javascript"}),r=URL.createObjectURL(i);this._worker=new Worker(r),this._state="loaded",e(this)}catch(e){console.log("There has been a problem with your fetch operation: ",e.message),n(e)}})}postMessage(e){let{msg:t}=e;this._worker.postMessage(t)}onMessage(e){return this._worker.onmessage=e}}class U{constructor(e){let{system:t}=e;this._environment={system:t},this._daemons={},this._daemonsDEFS={}}addDaemontDefinition(e){let{daemonDefinition:t}=e;this._daemonsDEFS[t.daemonInterface.config.name]=t}installDaemon(e){let{name:t}=e;const{system:n}=this._environment,{daemonInterface:i}=this._daemonsDEFS[t];i.lifecycle.install({system:n})}}var H={getNew_DaemonsManager:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new U(e)},getNew_Worker:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new q(e)}};function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach((function(t){G(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={config:B({},e.config),metadata:B({},e.metadata),lifecycle:{install:null,unistall:null}};return t},Z=e=>{let{definition:t}=e;return{name:t.config.name,definition:t}},K=e=>{let{system:t}=e;const n=t.getLibrary(),i={modules:{define:e=>n.addModuleDefinition(e),install:e=>n.installModule(e),get:e=>n.getModule(e)},addCommand:e=>t.addCommand(e)};return{deploy:()=>({deploySystem:i})}},X=e=>{let{manager:t}=e;const n={id:`packagesInstance-${Date.now()}`,manager:t,_interface:{plugins:{createDEF:e=>Y(_options),define:e=>n.manager.addPluginDefinition(e),install:e=>n.manager.installPlugin(e),info:e=>n.manager.getPluginsInfo(e)}},interface:()=>n._interface};return n};class J{constructor(e){let{system:t}=e;this._environment={system:t},this._pluginsDEFS={},this._plugins={}}getNewInstance(){return X({manager:this})}addPluginDefinition(e){let{pluginDefinition:t}=e;if(this._pluginsDEFS[t.config.name])throw Error("Plugin definition already exist");this._pluginsDEFS[t.config.name]=t}installPlugin(e){let{name:t}=e;const n=this._pluginsDEFS[t];if(void 0===n)throw Error("Plugin definition not found");const{system:i}=this._environment,r=K({system:i});n.lifecycle.install(r.deploy()),this._plugins[t]=Z({definition:n}),i._environment.mediator.publish("plugin_installed",{name:t})}getPluginsInfo(){return{plugins:Object.values(this._pluginsDEFS).reduce((e,t,n)=>(e[t.config.name]={name:t.config.name,metadata:t.metadata,installed:void 0!==this._plugins[t.config.name]},e),{}),total:Object.keys(this._pluginsDEFS).length,installed:Object.keys(this._plugins).length}}}var Q={defineDOMixPlugin:Y,getNew_PackagesManager:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new J(e)}};function ee(){return(ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const se={version:"0.0.1",build:51,stable:"alpha",mode:"develop"};se.versionIRI=`/core/${se.version}-${se.stable}/${se.build}/${se.mode}`;class oe{constructor(){this._tasks={},this._history={tasksLaunched:0,tasksFinished:0}}_addTask(e){let{id:t,type:n,lifecycle:i}=e,r=re(e,["id","type","lifecycle"]);this._tasks[t]=ne({id:t,type:n,lifecycle:i},r)}_runTask(e){let{id:t}=e;const n=this._tasks[t];n.lifecycle.start({task:n}),this._history.tasksLaunched++}getTasksInfo(){return{tasks:Object.values(this._tasks).reduce((e,t,n)=>(e[t.id]={id:t.id,type:t.type,description:t.metaDATA.description},e),{}),history:this._history}}runCommand(e){let{cmdHandler:t,command:n,setupTask:i}=e,r=re(e,["cmdHandler","command","setupTask"]);const s=Date.now(),o={id:`${n}${s}`,type:"command",metaDATA:{description:`task for command ${n}`},config:ne({command:n},r.config),lifecycle:{_time_start:s,_time_end:null,start:e=>{let{task:n}=e;return t(ne({},n.config,{lifecycle:n.lifecycle}))},end:e=>{let{result:t}=e;o.lifecycle._result=t,o.lifecycle._time_end=Date.now(),this._history.tasksFinished++,o.lifecycle.continue&&o.lifecycle.continue()},_result:null}};void 0!==i&&(o.lifecycle._setupTask=i({task:o})),this._addTask(o),this._runTask({id:o.id});const a={command:n,task:{id:`${o.id}`,time_start:o.lifecycle._time_start,time_end:o.lifecycle._time_end,result:o.lifecycle._result}};return null===o.lifecycle._time_end?void 0===o.lifecycle.wait?(a.task.result="end",a.task.time_end=Date.now(),delete this._tasks[o.id]):o.lifecycle.continue=e=>{ee({},e);delete this._tasks[o.id]}:delete this._tasks[o.id],a}}const ae=e=>{let{system:t}=e;const n={id:`systemInstance-${Date.now()}`,system:t,_library:t.library.getNewInstance(),_packages:t.packages.manager.getNewInstance(),_interface:{coms:()=>n.system.coms,commands:{exec:e=>n.system.execCommand(e),info:e=>n.system.getCommandsInfo(e)},library:()=>n._library.interface(),packages:()=>n._packages.interface(),domixInfo:()=>ne({systemID:n.system._id},se),tasks:()=>n.system._tasks.getTasksInfo()},interface:()=>n._interface};return n};class le{constructor(e){let{id:t="default"}=e;this._id=t,this._environment={commands:{},commandsExtra:{},library:new V({system:this}),mediator:null},this._tasks=new oe,this.daemons=H,this.packages={manager:Q.getNew_PackagesManager({system:this}),definePlugin:Q.defineDOMixPlugin},this.coms={getNew_Mediator:R.getNew_Mediator},this._init_Mediator()}_init_Mediator(){const e=this.coms.getNew_Mediator();e.installTo(this),this._environment=ne({},this._environment,{mediator:e}),e.subscribe("plugin_installed",e=>{console.log("SYSTEM -> plugin_installed",e)}),e.subscribe("module_installed",e=>{console.log("SYSTEM -> module_installed",e)})}getLibrary(){return this._environment.library}get library(){return this._environment.library}getNewInstance(){return ae({system:this})}addCommand(e){let{name:t,description:n="",handler:i,extra:r={},isCore:s=!1}=e;const o=this._environment.commands,a=this._environment.commandsExtra;if(o[t]||a[t])throw new Error("Command duplicated");s?o[t]={name:t,description:n,handler:i,extra:r}:a[t]={name:t,description:n,handler:i,extra:r}}getCommandsInfo(){return{commands:Object.values(this._environment.commands).map(e=>({name:e.name,description:e.description})),commandsExtra:Object.values(this._environment.commandsExtra).map(e=>({name:e.name,description:e.description}))}}execCommand(e){let{command:t="",data:n,commandLine:i="",term:r,setupTask:s}=e;const o=this._environment.commands[t],a=this._environment.commandsExtra[t];if(void 0===o&&void 0===a)throw new Error(`Command not found: ${t}`);const l=o||a;return{result:this._tasks.runCommand({command:t,cmdHandler:l.handler,setupTask:s,config:{term:r,data:n,commandLine:i,extra:l.extra}}).task.result,command:t,commandLine:i}}}function ce(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(n,!0).forEach((function(t){me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const he=e=>{let{controller:t,authorization:n={}}=e;const{term:i}=t._config,r={id:`controllerInstance-${Date.now()}`,controller:t,term:i,authorization:n,_sysInstance:null,_buffer:null,_input:null,_history:[],_decorator:{},_init:()=>{r._sysInstance=t._environment.system.getNewInstance({authorization:n}),r._buffer=r.term._termBuffer.getNewInstance({authorization:r.authorization}),r._input=r.term._termInput.getNewInstance({authorization:r.authorization}),r._termInterface=ue({},r._termInterface,{},r._buffer.interface(),{},r._input.interface());const e=(e=>{let{term:t}=e;const n={_term:t,_interface:{commands:{start:e=>{let{command:t}=e;i().addLine({type:"command-start",text:t,updateRender:!0})},end:()=>{i().addLine({type:"command-end",updateRender:!0})},setupTask:e=>{let{task:t}=e;const n={task:t,_taskLC:ue({},t.lifecycle),_lifecycle:ue({},t.lifecycle,{end:e=>{r().commands.end(),n._taskLC.end(e)}})};return t.lifecycle=n._lifecycle,n}}}},i=()=>n._term,r=()=>n._interface;return n.interface=r,n})({term:r._termInterface});r._decorator=ue({_obj:e},e.interface())},system:()=>(null===r._sysInstance&&null!==t._environment.system&&r._init(),null!==r._sysInstance?r._sysInstance.interface():null),_termInterface:{execCommand:e=>{let{command:t}=e,n=ce(e,["command"]);if(""!==t){o().commands.start({command:t});try{const e=r.system().commands.exec(ue({command:t},n,{term:s(),setupTask:o().commands.setupTask}));r._history.push(ue({},e))}catch(e){console.error("ERROR!",e),s().addLines(["Something happens:",e.message]),s().addLine({type:"command-end"})}}},getSystem:e=>r.system(),system:e=>r.system(),getCommandsHistory:e=>r._history},interface:()=>r._termInterface},s=()=>r._termInterface,o=()=>r._decorator;return r.system(),!0!==n.execCommand&&delete r._termInterface.execCommand,r};class fe{constructor(e){let{term:t}=e;this._environment={system:null},this._config={history:[],term:t},!1===t.sysless&&this._init_System()}_init_System(){const e=we.getNew_DomixSystem();we.initCoreLayer({system:e}),this._environment.system=e}getNewInstance(e){return he(ue({controller:this},e))}getSystem(){return this._environment.system}bindSystem(e){let{system:t}=e;if(null!==this._environment.system)throw Error("This terminal has a system");this._environment.system=t;const{term:n}=this._config;n._termInput.update()}}const pe={version:"0.0.1",build:51,stable:"alpha",mode:"develop"};pe.versionIRI=`/core/${pe.version}-${pe.stable}/${pe.build}/${pe.mode}`;const ge={list(e){const t=e.term,n=e.lifecycle,i=t.getSystem().commands.info();t.addLine("Command List:"),t.addLine("Core Commands:"),i.commands.map(e=>{t.addLine(`- ${e.name} -> ${e.description}`)}),t.addLine(`Total Core commands: ${i.commands.length}`),t.addLine("Extra Commands:"),i.commandsExtra.map(e=>{t.addLine(`- ${e.name} -> ${e.description}`)}),t.addLine(`Total Extra commands: ${i.commandsExtra.length}`),t.updateInput(),n.end({result:"ok"})},history(e){const t=e.term,n=e.lifecycle,i=t.getCommandsHistory();t.addLine("History:"),i.map(e=>{t.addLine(`${e.commandLine}`)}),t.addLine(`Total History commands: ${i.length}`),n.end({result:"ok"})},clear(e){let{term:t,lifecycle:n}=e;n.end({result:"ok"}),t.clear()},whoAmI(e){const t=e.term,n=t.getSystem().domixInfo(),i=e.lifecycle;t.addLines([`DOMix System ID: ${n.systemID}`,`- version: ${n.version} @build(${n.build})`,`- character: ${n.stable} @mode(${n.mode})`,`- DOMix Core IRI: ${n.versionIRI}`]),i.end({result:"ok"})}};var _e=e=>{let{system:t}=e;t.addCommand({name:"list",isCore:!0,description:"List the commands",handler:ge.list,extra:{}}),t.addCommand({name:"history",isCore:!0,description:"History of the commands",handler:ge.history,extra:{}}),t.addCommand({name:"clear",isCore:!0,description:"Clear the buffer",handler:ge.clear,extra:{}}),t.addCommand({name:"whoami",isCore:!0,description:"Info about this DOMix system",handler:ge.whoAmI,extra:{}})};function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(n,!0).forEach((function(t){ve(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var we={getNew_TermController:e=>new fe(e),getNew_DomixSystem:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return console.log("getNew_DomixSystem"),new le(be({id:`domix@${Date.now()}`},e))},initCoreLayer:e=>{let{system:t}=e;_e({system:t})}};const Oe={Shell:"shell",Request:"request"},xe=e=>{let{termInput:t}=e;const n={id:`inputInstance-${Date.now()}`,termInput:t,_interface:{request:e=>n.termInput.request(e),updateInput:e=>n.termInput.update(e)},interface:()=>n._interface};return n};var De=class{constructor(e){let{termController:t}=e;this._myDIV=document.createElement("div"),this._termController=t.getNewInstance({authorization:{execCommand:!0}}),this._mode=Oe.Shell,this._user_command={command:""},this._request={userInput:"",requestHandler:null,extra:null},this.getComponent=this.getComponent.bind(this),this.update=this.update.bind(this),this._handleKeyDownCommand=this._handleKeyDownCommand.bind(this),this.request=this.request.bind(this),this._render(),this._inputForCommand=this._myDIV.querySelector('input[name="user_command"]')}_render(){const e=this._renderUserControls();$(e,this._myDIV)}update(){this._render()}getComponent(){return this._myDIV}getNewInstance(e){return xe({termInput:this})}_renderUserControls(){const e=this._mode===Oe.Shell?"commands":"";return A`<input type="text" name="user_command" size="60" placeholder="Type some command" list="${e}" @keydown="${e=>this._handleKeyDownCommand(e)}"><datalist id="commands"><select name="commands">${this._renderOptionsForCommands()}</select></datalist>`}_renderOptionsForCommands(){if(void 0===this._termController||null===this._termController.system())return;const e=this._termController.interface().getSystem().commands.info();return A`${e.commands.map(e=>A`<option value="${e.name}"></option>`)} ${e.commandsExtra.map(e=>A`<option value="${e.name}"></option>`)}`}_handleKeyDownCommand(e){switch(e.keyCode){case 13:this._processInput()}}_processInput(){switch(this._mode){case Oe.Shell:this._processCommand();break;case Oe.Request:this._processRequest()}}_processCommand(){this._user_command.command=`${this._inputForCommand.value}`,this._inputForCommand.value="";const e=this._user_command.command.trim().split(" ")[0];this._termController.interface().execCommand({commandLine:`${this._user_command.command}`,command:e,data:{key:"somekey"}})}_processRequest(){this._request.userInput=`${this._inputForCommand.value}`,this._inputForCommand.value="";const e=this._request.requestHandler({userInput:this._request.userInput,extra:this._request.extra});"function"==typeof e?e():this._mode=Oe.Shell,this.update()}request(e){let{requestHandler:t,extra:n=null}=e;this._request.requestHandler=t,this._request.extra=n,this._mode=Oe.Request,this.update()}};function Ce(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach((function(t){Pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Se{constructor(e){let{type:t="text",text:n="",html:i}=e;this._myDiv=document.createElement("div"),this._type=t,this._text=n,this._html=i||function(){},this.getComponent=this.getComponent.bind(this),this.update=this.update.bind(this),this._render()}_render(){const e=A`<div data-rol="buffer-line" part="buffer-line">${this._renderContent()} ${this._html()}</div>`;$(e,this._myDiv)}_renderContent(){let e="";switch(this._type){case"text":e=A`${this._text}`}return e}update(){this._render()}getComponent(){return this._myDiv}}const Ie=e=>{let{buffer:t}=e;const n={id:`bufferInstance-${Date.now()}`,buffer:t,_fragments:{},_interface:{addLine:function(){return n.buffer.addLine(...arguments)},addLines:function(){return n.buffer.addLines(...arguments)},clear:e=>n.buffer.clear(e),updateBuffer:e=>n.buffer.update(e),fragments:{create:e=>{let{id:t}=e;if(i().fragments.isFragment())throw Error("Cannot create a fragment inside a fragment");const r=new Ne({id:t,buffer:n.buffer});return n._fragments[t]=r,r},isFragment:()=>!0===n.buffer._isFragment,get:e=>{let{id:t}=e;return n._fragments[t]}}},interface:()=>n._interface},i=()=>n._interface;return n.interface=i,n};class ke{constructor(){this._myDIV=document.createElement("div"),this._buffer={lines:[]},this.getComponent=this.getComponent.bind(this),this.update=this.update.bind(this),this.addLine=this.addLine.bind(this),this.addLines=this.addLines.bind(this),this.clear=this.clear.bind(this),this._render(),this._bufferLayer=this._myDIV.querySelector('div[part="buffer"]')}_render(){const e=this._renderBuffer();$(e,this._myDIV)}_renderBuffer(){return A`<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Sans"><div data-rol="buffer" part="buffer">${this._buffer.lines.map(e=>e.getComponent())}</div>`}update(){this._render(),this._bufferLayer.scrollTop=this._bufferLayer.scrollHeight}getComponent(){return this._myDIV}getNewInstance(){return Ie({buffer:this})}addLine(e){let{type:t="text",text:n="",html:i=(()=>{}),updateRender:r=!1}=e;for(var s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];if("string"==typeof arguments[0]){const e=void 0!==o[1]?o[1]:{};return this.addLine(Ee({text:arguments[0]},e))}switch(t){case"text":case"html":this._buffer.lines.push(new Se({type:t,text:n,html:i}));break;case"command-start":this._buffer.lines.push(new Se({type:"text",text:`‚öô‚ñ´‚ñ´‚ñ´ [ ${n} ]üîΩüèÅ`}));break;case"command-end":this._buffer.lines.push(new Se({type:"text",text:"‚öô‚ñ´‚ñ´‚ñ´ [‚úî]"})),r=!0}!0===r&&this.update()}addLines(e){let{lines:t=[],updateRender:n=!1}=e,i=Ce(e,["lines","updateRender"]);for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];if(Array.isArray(arguments[0])){const e=s[1]?s[1]:{};return this.addLines(Ee({lines:arguments[0]},e,{updateRender:!1}))}for(const e of t)"string"==typeof e?this.addLine(Ee({text:e},i,{updateRender:!1})):this.addLine(Ee({text:e.text},i,{updateRender:!1}));!0===n&&this.update()}clear(){this._buffer.lines=[],this.update()}}class Ne extends ke{constructor(e){let{id:t,buffer:n}=e;super(),this._id=t,this._isFragment=!0,this._config={parent:n}}_renderBuffer(){return A`<div data-rol="buffer-frament" part="buffer">${this._buffer.lines.map(e=>e.getComponent())}</div>`}}var Te=ke;class Me extends HTMLElement{constructor(){super(),this._termController=we.getNew_TermController({term:this}),this._termBuffer=null,this._init_Buffer(),this._termInput=null,this._init_TermInput(),this.attachShadow({mode:"open"}),this._render()}_init_Buffer(){this._termBuffer=new Te}_init_TermInput(){this._termInput=new De({termController:this._termController})}connectedCallback(){this._initWelcome()}_initWelcome(){this.addLine({text:"D‚öôM‚ùó‚ùå running... üëΩ",updateRender:!0})}static get observedAttributes(){return[]}attributeChangedCallback(e,t,n){}get sysless(){return this.hasAttribute("sysless")}set sysless(e){e?this.setAttribute("sysless",""):this.removeAttribute("sysless")}_render(){const e=A`<style></style><div data-rol="term">${this._termBuffer.getComponent()}<div data-rol="user_controls">${this._termInput.getComponent()}</div></div>`;$(e,this.shadowRoot)}get controller(){return this._termController}addLine(e){this._termBuffer.addLine(e)}clear(e){this._termBuffer.clear(e)}requestData(e){this._termInput.request(e)}bindSystem(e){this._termController.bindSystem(e),this._termInput.update()}}window.customElements.define("domix-term",Me);class Le{constructor(e){let{id:t="default"}=e;this._id=t,this._zones={}}addZone(e){let{zone:t}=e;this._zones[t._id]=t}getZone(e){let{id:t}=e;return this._zones[t]}}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Fe{constructor(e){let{id:t="default"}=e;this._id=t,this._regions={}}addRegion(e){let{region:t}=e;this._regions[t._id]=t}getRegion(e){let{id:t}=e;return this._regions[t]}getUnits(){return Object.values(this._regions).reduce((e,t)=>(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(n,!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e})({},e,{},t._units),{})}}class We{constructor(e){let{id:t="default"}=e;this._id=t,this._units={}}addUnit(e){let{unit:t}=e;this._units[t._id]=t}getUnit(e){let{id:t}=e;return this._units[t]}}const Ve={WINDOW:"window"},Re={LOGIC:"logic",GRAPHICS:"graphics"};class qe{constructor(e){let{id:t,type:n,natures:i=[]}=e;this._id=t,this._type=n,this._natures=i,this._position={x:0,y:0,z:0},this._dimensions={x:1,y:1,z:1}}}var Ue={getNew_Theater:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Le(e)},getNew_Zone:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Fe(e)},getNew_Region:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new We(e)},getNew_Unit:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new qe(e)},UNIT_TYPES:Ve,UNIT_NATURES:Re};class He{constructor(e){let{id:t,content:n,unitController:i}=e;this._id=t,this._unitController=i,this._DOM_id=`unit_${this._id}`,this._myDIV=document.createElement("div"),this._content=n,this._drag={start:{x:0,y:0},end:{x:0,y:0}},this.getComponent=this.getComponent.bind(this),this.update=this.update.bind(this),this._closeDragElement=this._closeDragElement.bind(this),this._dragMouseDown=this._dragMouseDown.bind(this),this._elementDrag=this._elementDrag.bind(this),this.getContent=this.getContent.bind(this),this._render(),this._layerForWindow=this._myDIV.querySelector(`#${this._DOM_id}`),this._layerForContent=this._myDIV.querySelector(`#${this._DOM_id} p[data-rol="content"]`)}_render(){const e=A`<style>.Window{position:absolute;z-index:9;background-color:#f1f1f1;text-align:center;border:1px solid #d3d3d3}.Window div[data-rol="header"]{padding:10px;cursor:move;z-index:10;background-color:#2196f3;color:#fff}</style><div class="Window" id="${this._DOM_id}"><div data-rol="header" @mousedown="${this._dragMouseDown}">Click here to move</div><p data-rol="content">${this._content}</p></div>`;$(e,this._myDIV)}update(){this._render()}getComponent(){return this._myDIV}getContent(){return this._layerForContent}_dragMouseDown(e){(e=e||window.event).preventDefault(),this._drag.start.x=e.clientX,this._drag.start.y=e.clientY,document.onmouseup=this._closeDragElement,document.onmousemove=this._elementDrag}_elementDrag(e){(e=e||window.event).preventDefault();const t=this._drag.start.x-e.clientX,n=this._drag.start.y-e.clientY;this._drag.start.x=e.clientX,this._drag.start.y=e.clientY;const i=this._layerForWindow;i.style.top=i.offsetTop-n+"px",i.style.left=i.offsetLeft-t+"px"}_closeDragElement(){document.onmouseup=null,document.onmousemove=null}}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Ye={generatetUnit:e=>{let{id:t,type:n}=e,i=Ge(e,["id","type"]),r=null;switch(n){case Ue.UNIT_TYPES.WINDOW:(r=(e=>{let{unit:t}=e;return{id:t._id,unit:t,theaterUnit:null,component:null}})({unit:r=Ue.getNew_Unit({id:t,type:n,natures:[Ue.UNIT_NATURES.GRAPHICS]})})).theaterUnit=new He(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(n,!0).forEach((function(t){Be(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:t},i)),r.component=r.theaterUnit.getComponent()}return r}};function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(n,!0).forEach((function(t){Xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Je{constructor(e){let{id:t,config:n,metaDATA:i}=e;this._id=t,this._config=Ke({name:"",version:"",viewmodes:[]},n),this._metaDATA=Ke({description:"",author:{name:"",email:""}},i)}install(){}getContent(){}destroy(){}unistall(){}}function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class nt{constructor(e){let{widget:t,theaterEngine:n,system:i}=e;this._widget=t,this._environment={system:i,theaterEngine:n}}}const it=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={config:et({},e.config),metadata:et({},e.metadata),lifecycle:{install:null,useWidget:null,getContent:null,destroy:null,unistall:null}};class n extends Je{constructor(e){super(e);const{lifecycle:t}=e.widgetInterface;this.getContent=t.getContent,this.destroy=t.destroy}}return{widgetInterface:t,CustomWidget:n}},rt=e=>{let{name:t,widget:n,theaterEngine:i,system:r,widgetDefinition:s}=e;return{id:n&&n._id?n._id:t,widget:n||null,widgetEngine:n?new nt({widget:n,theaterEngine:i,system:r}):null,widgetDefinition:s,instances:{}}};class st{constructor(e){let{system:t,theaterEngine:n}=e;this._environment={system:t,theaterEngine:n},this._widgets={},this._widgetsDEFS={}}addWidget(e){let{widget:t}=e;const{theaterEngine:n,system:i}=this._environment;this._widgets[t._id]=rt({widget:t,theaterEngine:n,system:i})}getWidget(e){let{id:t}=e;return this._widgets[t]}addWidgetDefinition(e){let{widgetDefinition:t}=e;this._widgetsDEFS[t.widgetInterface.config.name]=t}installWidget(e){let{name:t}=e;const{system:n,theaterEngine:i}=this._environment,{widgetInterface:r}=this._widgetsDEFS[t];r.lifecycle.install({system:n,theaterEngine:i})}useWidget(e){let{name:t,command:n}=e;const{theaterEngine:i,system:r}=this._environment,s=this._widgetsDEFS[t];let o=this._widgets[t];void 0===o&&(o=this._widgets[t]=rt({name:t,widgetDefinition:s,theaterEngine:i,system:r})),s.widgetInterface.lifecycle.useWidget({widget:o});const a=new s.CustomWidget({widgetInterface:s.widgetInterface}),l=`${t}_${Date.now()}`,c=i.getController().addUnit({id:l,type:"window",content:a.getContent()});s.widgetInterface.lifecycle.unitCreated({widget:o,widgetInstance:a,unit:c.unit,system:r}),o.instances[l]=a}}var ot={WIDGET_CONFIG:{VIEWMODES:{WINDOW:"window"}},getNew_Widget:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Je(e)},getNew_WidgetsManager:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new st(e)},defineTheaterWidget:it};function at(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(n,!0).forEach((function(t){dt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ut=e=>{let{id:t="default",theater:n}=e;const i={id:t,theater:n,mediator:R.getNew_Mediator()};return i.mediator.installTo(i),i};class mt{constructor(e){let{theater:t,engine:n}=e;this._theater=t,this._engine=n,this._initCOMS()}_initCOMS(){const e=this._engine;e._comSystem.subscribe("unitAdded",t=>e._manageUnitAdded(t))}addUnit(e){let{id:t,type:n,zone:i="default",region:r="default"}=e,s=at(e,["id","type","zone","region"]);const o=Ye.generatetUnit(ct({id:t,type:n},s)),a=this._engine._comSystem,l=this._theater;void 0===l._zones[i]&&l.addZone({zone:Ue.getNew_Zone({id:i})});const c=l._zones[i];return void 0===c._regions[r]&&c.addRegion({region:Ue.getNew_Region({id:r})}),this._theater._zones[i]._regions[r].addUnit({unit:o.unit}),a.publish("unitAdded",{unitContext:o,zone:i,region:r}),{unit:o,zone:i,region:r}}}class ht{constructor(e){let{theater:t,layerForContainer:n,component:i}=e;this._environment={theater:t,theaterComponent:i,layerForContainer:n},this._graphics={units:{}},this._widgets={manager:ot.getNew_WidgetsManager({system:i._environment.system,theaterEngine:this})},this._comSystem=ut({theater:t}),this._controller=new mt({theater:t,engine:this}),this._manageUnitAdded=this._manageUnitAdded.bind(this)}_manageUnitAdded(e){console.log("TheaterEngine -> _manageUnitAdded",e);const{unitContext:t}=e,n=this._environment.layerForContainer;t.unit._natures.includes(Re.GRAPHICS)&&(this._graphics.units[t.id]=t,n.appendChild(t.component))}getController(){return this._controller}getWidgetsManager(){return this._widgets.manager}}var ft={widgets:{WidgetTerm:{defineWidget:e=>{const{theaterEngine:t,system:n}=e,i=ot.defineTheaterWidget(),r=i.widgetInterface;r.config={name:"term",version:"0.0.1",viewModes:[ot.WIDGET_CONFIG.VIEWMODES.WINDOW],widget:{maxWidth:"",maxHeight:""}},r.metadata={description:"DOMix terminal",author:{name:"Unlevel Team"}},r.lifecycle={install:e=>{},useWidget:e=>{},getContent:e=>A`<link href="https://unlevel-team.github.io/domix-underground/dist/domix-term.css" rel="stylesheet" type="text/css"><domix-term sysless></domix-term>`,destroy:e=>{},unitCreated:e=>{const{theaterUnit:t}=e.unit;t.getContent().querySelector("domix-term").bindSystem({system:e.system})},unistall:e=>{}},t.getWidgetsManager().addWidgetDefinition({widgetDefinition:i})},install:e=>{let{theaterEngine:t}=e;t.getWidgetsManager().installWidget({name:"term"})}}}};class pt extends HTMLElement{constructor(){super(),this._environment={theater:null,system:null},this._engine=null,this._layerForContainer=null,this.bindSystem=this.bindSystem.bind(this),this.attachShadow({mode:"open"}),this._render()}_init_Theater(e){let{system:t}=e;this._layerForContainer=this.shadowRoot.querySelector("#TheaterContainer"),this._environment.theater=Ue.getNew_Theater(),void 0===t&&(this._environment.system=we.getNew_DomixSystem(),we.initCoreLayer({system:this._environment.system})),this._engine=new ht({theater:this._environment.theater,layerForContainer:this._layerForContainer,component:this}),this._init_Term()}_init_Term(){ft.widgets.WidgetTerm.defineWidget({theaterEngine:this._engine,system:this._environment.system}),ft.widgets.WidgetTerm.install({theaterEngine:this._engine}),this._engine.getWidgetsManager().useWidget({name:"term"})}connectedCallback(){!1===this.sysless&&this._init_Theater()}static get observedAttributes(){return["sysless"]}attributeChangedCallback(e,t,n){}get sysless(){return this.hasAttribute("sysless")}set sysless(e){e?this.setAttribute("sysless",""):this.removeAttribute("sysless")}get system(){return this._environment.system}_render(){const e=A`<style>.TheaterContainer{min-height:350px;height:100%;min-width:400px;width:100%;background-color:#2f4f4f}</style><div id="TheaterContainer" class="TheaterContainer"></div>`;$(e,this.shadowRoot)}bindSystem(e){let{system:t}=e;null===this._environment.system&&(this._environment.system=t,this._init_Theater({system:t}))}}window.customElements.define("domix-theater",pt);class gt extends HTMLElement{constructor(){super(),this._environment={system:null},this._theater=null,this._term=null,this.attachShadow({mode:"open"}),this._render()}connectedCallback(){this._theater=this.shadowRoot.querySelector("domix-theater"),this._term=this.shadowRoot.querySelector("domix-term"),this._initSystem()}_initSystem(){const e=we.getNew_DomixSystem();we.initCoreLayer({system:e}),this._environment.system=e,this._theater.bindSystem({system:this._environment.system}),this._term.bindSystem({system:this._environment.system})}static get observedAttributes(){return[]}attributeChangedCallback(e,t,n){}_render(){const e=A`<link href="https://unlevel-team.github.io/domix-underground/dist/domix-term.css" rel="stylesheet" type="text/css"><domix-theater sysless></domix-theater><domix-term sysless exportparts="domix-term-*"></domix-term>`;$(e,this.shadowRoot)}get_Term(){return this._term}get_Theater(){return this._theater}}window.customElements.define("domix-playground",gt);t.default={DOMixPlayground:gt}}]);
//# sourceMappingURL=601c8d8ad56c9d39cefb.js.map